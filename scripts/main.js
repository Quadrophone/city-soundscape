"use strict";function initAudio(e,t){var n=new Audio5js({ready:function(){this.load(e.url),this.play()}});players.push(n)}function playSounds(){for(var e=soundsToPlay.length,t=0;5>t;t++)initAudio(soundsToPlay[Math.floor(Math.random()*e)+1],t);playing=!0}function getSounds(e){for(var t=1;10>t;t++)freesound.textSearch("",{filter:e,page:t,fields:"previews,name,url,id,duration",sort:"rating_desc"},function(e){for(var t in e.results){var n=e.results[t].previews["preview-hq-mp3"],o=e.results[t].duration,r={};r.url=n,r.duration=o,soundsToPlay.push(r)}playSounds()},function(e){console.log(e)})}function setLocation(e,t){var n=e-1.506,o=e+1.506,r=t-1.506,a=t+1.506;filterString='geotag:"Intersects('+r+" "+n+" "+a+" "+o+')"',getSounds(filterString)}function getPhotos(e){var t=encodeURIComponent(e);$.ajax({url:"https://pixabay.com/api/?q="+t+"&min_width=1480&page=1&per_page=10&key=2093948-e4a1edf955271cac762941f3b",method:"GET",success:function(e){if(e.hits.length>0){var t=e.hits[Math.floor(Math.random()*e.hits.length)+1],n=t.webformatURL;n=n.replace("_640","_960"),console.log(n),$("body").css("background-image",'url("'+n+'")')}}})}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};!function(){var freesound=function freesound(){var authHeader="",clientId="",clientSecret="",host="freesound.org",uris={base:"https://"+host+"/apiv2",textSearch:"/search/text/",contentSearch:"/search/content/",combinedSearch:"/sounds/search/combined/",sound:"/sounds/<sound_id>/",soundAnalysis:"/sounds/<sound_id>/analysis/",similarSounds:"/sounds/<sound_id>/similar/",comments:"/sounds/<sound_id>/comments/",download:"/sounds/<sound_id>/download/",upload:"/sounds/upload/",describe:"/sounds/<sound_id>/describe/",pending:"/sounds/pending_uploads/",bookmark:"/sounds/<sound_id>/bookmark/",rate:"/sounds/<sound_id>/rate/",comment:"/sounds/<sound_id>/comment/",authorize:"/oauth2/authorize/",logout:"/api-auth/logout/",logoutAuthorize:"/oauth2/logout_and_authorize/",me:"/me/",user:"/users/<username>/",userSounds:"/users/<username>/sounds/",userPacks:"/users/<username>/packs/",userBookmarkCategories:"/users/<username>/bookmark_categories/",userBookmarkCategorySounds:"/users/<username>/bookmark_categories/<category_id>/sounds/",pack:"/packs/<pack_id>/",packSounds:"/packs/<pack_id>/sounds/",packDownload:"/packs/<pack_id>/download/"},makeUri=function(e,t){for(var n in t)e=e.replace(/<[\w_]+>/,t[n]);return uris.base+e},makeRequest=function makeRequest(uri,success,error,params,wrapper,method,data,content_type){void 0===method&&(method="GET"),error||(error=function(e){console.log(e)}),params=params||{},params.format="json";var fs=this,parse_response=function parse_response(response){var data=eval("("+response+")");success(wrapper?wrapper(data):data)},paramStr="";for(var p in params)paramStr=paramStr+"&"+p+"="+params[p];if(paramStr&&(uri=uri+"?"+paramStr),"undefined"!=typeof module){var http=require("http"),options={host:host,path:uri.substring(uri.indexOf("/",8),uri.length),port:"80",method:method,headers:{Authorization:authHeader}},req=http.request(options,function(e){e.setEncoding("utf8"),e.on("data",function(t){[200,201,202].indexOf(e.statusCode)>=0?success(wrapper?wrapper(t):t):error(t)})});req.on("error",error).end()}else{var xhr;try{xhr=new XMLHttpRequest}catch(e){xhr=new ActiveXObject("Microsoft.XMLHTTP")}xhr.onreadystatechange=function(){if(4===xhr.readyState&&[200,201,202].indexOf(xhr.status)>=0){var data=eval("("+xhr.responseText+")");success&&success(wrapper?wrapper(data):data)}else 4===xhr.readyState&&200!==xhr.status&&error&&error(xhr.statusText)},xhr.open(method,uri),xhr.setRequestHeader("Authorization",authHeader),void 0!==content_type&&xhr.setRequestHeader("Content-Type",content_type),xhr.send(data)}},checkOauth=function(){if(-1==authHeader.indexOf("Bearer"))throw"Oauth authentication required"},makeFD=function(e,t){t||(t=new FormData);for(var n in e)t.append(n,e[n]);return t},search=function(e,t,n,o,r){e.analysis_file?makeRequest(makeUri(t),n,o,null,r,"POST",makeFD(e)):makeRequest(makeUri(t),n,o,e,r)},Collection=function e(t){var n=function(t,n,o){makeRequest(t,n,o,{},e)};return t.nextPage=function(e,o){n(t.next,e,o)},t.previousPage=function(e,o){n(t.previous,e,o)},t.getItem=function(e){return t.results[e]},t},SoundCollection=function(e){var t=Collection(e);return t.getSound=function(e){return new SoundObject(t.results[e])},t},PackCollection=function(e){var t=Collection(e);return t.getPack=function(e){return new PackObject(t.results[e])},t},SoundObject=function(e){return e.getAnalysis=function(t,n,o,r){makeRequest(makeUri(uris.soundAnalysis,[e.id,t?t:""]),n,o)},e.getSimilar=function(t,n,o){makeRequest(makeUri(uris.similarSounds,[e.id]),t,n,o,SoundCollection)},e.getComments=function(t,n){makeRequest(makeUri(uris.comments,[e.id]),t,n,{},Collection)},e.download=function(t){checkOauth();var n=makeUri(uris.download,[e.id]);t.location=n},e.comment=function(t,n,o){checkOauth();var r=new FormData;r.append("comment",comment);var a=makeUri(uris.comment,[e.id]);makeRequest(a,n,o,{},null,"POST",r)},e.rate=function(t,n,o){checkOauth();var r=new FormData;r.append("rating",t);var a=makeUri(uris.rate,[e.id]);makeRequest(a,n,o,{},null,"POST",r)},e.bookmark=function(t,n,o,r){checkOauth();var a=new FormData;a.append("name",t),n&&a.append("category",n);var s=makeUri(uris.bookmark,[e.id]);makeRequest(s,o,r,{},null,"POST",a)},e.edit=function(t,n,o){checkOauth();var r=makeFD(t),a=makeUri(uris.edit,[e.id]);makeRequest(a,n,o,{},null,"POST",r)},e},UserObject=function(e){return e.sounds=function(t,n,o){var r=makeUri(uris.userSounds,[e.username]);makeRequest(r,t,n,o,SoundCollection)},e.packs=function(t,n){var o=makeUri(uris.userPacks,[e.username]);makeRequest(o,t,n,{},PackCollection)},e.bookmarkCategories=function(t,n){var o=makeUri(uris.userBookmarkCategories,[e.username]);makeRequest(o,t,n)},e.bookmarkCategorySounds=function(t,n,o){var r=makeUri(uris.userBookmarkCategorySounds,[e.username]);makeRequest(r,t,n,o)},e},PackObject=function(e){return e.sounds=function(t,n){var o=makeUri(uris.packSounds,[e.id]);makeRequest(o,t,n,{},SoundCollection)},e.download=function(t){checkOauth();var n=makeUri(uris.packDownload,[e.id]);t.location=n},e};return{setToken:function(e,t){authHeader=("oauth"===t?"Bearer ":"Token ")+e},setClientSecrets:function(e,t){clientId=e,clientSecret=t},postAccessCode:function(e,t,n){var o=uris.base+"/oauth2/access_token/",r=new FormData;r.append("client_id",clientId),r.append("client_secret",clientSecret),r.append("code",e),r.append("grant_type","authorization_code"),t||(t=function(e){setToken(e.access_token,"oauth")}),makeRequest(o,t,n,{},null,"POST",r)},textSearch:function(e,t,n,o){t=t||{},t.query=e?e:" ",search(t,uris.textSearch,n,o,SoundCollection)},contentSearch:function(e,t,n){if(!e.target&&!e.analysis_file)throw"Missing target or analysis_file";search(e,uris.contentSearch,t,n,SoundCollection)},combinedSearch:function(e,t,n){if(!(e.target||e.analysis_file||e.query))throw"Missing query, target or analysis_file";search(e,uris.contentSearch,t,n)},getSound:function(e,t,n){makeRequest(makeUri(uris.sound,[e]),t,n,{},SoundObject)},upload:function(e,t,n,o,r){checkOauth();var a=new FormData;a.append("audiofile",e,t),n&&(a=makeFD(n,a)),makeRequest(makeUri(uris.upload),o,r,{},null,"POST",a)},describe:function(e,t,n,o,r,a){checkOauth();var s=makeFD(t);makeRequest(makeUri(uris.upload),r,a,{},null,"POST",s)},getPendingSounds:function(e,t){checkOauth(),makeRequest(makeUri(uris.pending),e,t,{})},me:function(e,t){checkOauth(),makeRequest(makeUri(uris.me),e,t)},getLoginURL:function(){if(void 0===clientId)throw"client_id was not set";var e=makeUri(uris.authorize);return e+="?client_id="+clientId+"&response_type=code"},getLogoutURL:function(){var e=makeUri(uris.logoutAuthorize);return e+="?client_id="+clientId+"&response_type=code"},getUser:function(e,t,n){makeRequest(makeUri(uris.user,[e]),t,n,{},UserObject)},getPack:function(e,t,n){makeRequest(makeUri(uris.pack,[e]),t,n,{},PackObject)}}};"undefined"!=typeof module?module.exports=freesound():"function"==typeof define&&"object"===_typeof(define.amd)?define("freesound",[],freesound):window.freesound=freesound()}();var filterString,location,soundsToPlay=[],players=[],playing=!1;freesound.setToken("86cc9bae2d8272e90bd21b370dc72bcd5e295095"),$(document).ready(function(){var e,t={types:["(cities)"]},n=document.getElementById("location"),o=new google.maps.places.Autocomplete(n,t);o.addListener("place_changed",function(){e=o.getPlace()}),$("#play").click(function(t){t.preventDefault(),playing===!0&&players.forEach(function(e){e.destroy()});var n=e.geometry.location,o=n.lat(),r=n.lng();setLocation(o,r),getPhotos(e.name)}),$("#stop").click(function(e){e.preventDefault(),playing===!0&&players.forEach(function(e){e.destroy()})})});